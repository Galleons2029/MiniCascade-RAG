# Intent Agent æµ‹è¯•æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å¦‚ä½•æµ‹è¯•å’Œç›‘æ§ MiniCascade-RAG é¡¹ç›®ä¸­çš„ Intent Agent ç»„ä»¶ã€‚

## ğŸ¯ æµ‹è¯•ç›®æ ‡

1. **åŠŸèƒ½æ­£ç¡®æ€§**: éªŒè¯æ„å›¾è¯†åˆ«çš„å‡†ç¡®æ€§
2. **æ€§èƒ½è¡¨ç°**: æµ‹è¯•å“åº”æ—¶é—´å’Œå¹¶å‘å¤„ç†èƒ½åŠ›
3. **æµç¨‹è¿½è¸ª**: é€šè¿‡ LangSmith ç›‘æ§æ•´ä¸ªå¤„ç†æµç¨‹
4. **é”™è¯¯å¤„ç†**: éªŒè¯å¼‚å¸¸æƒ…å†µä¸‹çš„ç³»ç»Ÿè¡Œä¸º

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### 1. åŸºç¡€ç¯å¢ƒå˜é‡

```bash
# å¿…éœ€é…ç½®
LLM_API_KEY=your_api_key_here
LLM_MODEL=Qwen/Qwen2.5-7B-Instruct
LLM_BASE_URL=https://api.siliconflow.cn/v1  # å¯é€‰ï¼Œç”¨äºè‡ªå®šä¹‰ API ç«¯ç‚¹

# é¡¹ç›®é…ç½®
PROJECT_NAME=MiniCascade-RAG
ENVIRONMENT=development
```

### 2. LangSmith é…ç½®ï¼ˆå¯é€‰ï¼Œç”¨äºé«˜çº§ç›‘æ§ï¼‰

```bash
# LangSmith è¿½è¸ª
LANGCHAIN_API_KEY=your_langsmith_api_key
LANGCHAIN_TRACING_V2=true
LANGCHAIN_PROJECT=MiniCascade-RAG-Intent-Testing
```

è·å– LangSmith API Key: https://smith.langchain.com/

### 3. Langfuse é…ç½®ï¼ˆå¯é€‰ï¼Œç”¨äº LLM ç›‘æ§ï¼‰

```bash
LANGFUSE_PUBLIC_KEY=your_public_key
LANGFUSE_SECRET_KEY=your_secret_key
LANGFUSE_HOST=https://cloud.langfuse.com
```

## ğŸ§ª æµ‹è¯•ç±»å‹

### 1. åŸºç¡€å•å…ƒæµ‹è¯•

æµ‹è¯• Intent Agent çš„æ ¸å¿ƒåŠŸèƒ½ï¼š

```bash
# è¿è¡ŒåŸºç¡€æµ‹è¯•
python scripts/test_intent_agent.py --test-type basic

# æˆ–ä½¿ç”¨ pytest ç›´æ¥è¿è¡Œ
pytest test/agent/test_intent_agent.py -v
```

**æµ‹è¯•å†…å®¹**:
- æ„å›¾åˆ†ç±»å‡†ç¡®æ€§
- å®ä½“æå–åŠŸèƒ½
- ä¸Šä¸‹æ–‡ç»§æ‰¿æœºåˆ¶
- é”™è¯¯å¤„ç†èƒ½åŠ›

### 2. LangSmith é›†æˆæµ‹è¯•

é€šè¿‡ LangSmith è¿›è¡Œè¯¦ç»†çš„æµç¨‹è¿½è¸ªï¼š

```bash
# è¿è¡Œ LangSmith æµ‹è¯•
python scripts/test_intent_agent.py --test-type langsmith
```

**åŠŸèƒ½ç‰¹ç‚¹**:
- å®Œæ•´çš„è°ƒç”¨é“¾è¿½è¸ª
- LLM è¾“å…¥è¾“å‡ºè®°å½•
- æ€§èƒ½æŒ‡æ ‡ç›‘æ§
- é”™è¯¯å †æ ˆè¿½è¸ª

**æŸ¥çœ‹ç»“æœ**: æµ‹è¯•å®Œæˆåï¼Œè®¿é—® [LangSmith Dashboard](https://smith.langchain.com/) æŸ¥çœ‹è¯¦ç»†è¿½è¸ªä¿¡æ¯ã€‚

### 3. æ€§èƒ½æµ‹è¯•

æµ‹è¯•ç³»ç»Ÿçš„æ€§èƒ½è¡¨ç°ï¼š

```bash
# è¿è¡Œæ€§èƒ½æµ‹è¯•
python scripts/test_intent_agent.py --test-type performance
```

**æµ‹è¯•æŒ‡æ ‡**:
- å¹³å‡å“åº”æ—¶é—´
- å¹¶å‘å¤„ç†èƒ½åŠ›
- ååé‡ç»Ÿè®¡
- èµ„æºä½¿ç”¨æƒ…å†µ

### 4. äº¤äº’å¼æµ‹è¯•

å®æ—¶æµ‹è¯•å’Œè°ƒè¯•ï¼š

```bash
# å¯åŠ¨äº¤äº’å¼æµ‹è¯•
python scripts/test_intent_agent.py --test-type interactive
```

**ä½¿ç”¨æ–¹å¼**:
1. è¾“å…¥æµ‹è¯•æ¶ˆæ¯
2. æŸ¥çœ‹å®æ—¶åˆ†æç»“æœ
3. éªŒè¯å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡
4. è¾“å…¥ `quit` é€€å‡º

## ğŸ“Š æµ‹è¯•ç”¨ä¾‹

### æ„å›¾åˆ†ç±»æµ‹è¯•ç”¨ä¾‹

| æ„å›¾ç±»å‹ | æµ‹è¯•æ¶ˆæ¯ | é¢„æœŸç»“æœ |
|---------|---------|---------|
| qa | "ä»€ä¹ˆæ˜¯RAGç³»ç»Ÿï¼Ÿ" | intent: qa |
| qa | "ä¸Šå‘¨çš„é”€å”®æ•°æ®æ˜¾ç¤ºäº†ä»€ä¹ˆè¶‹åŠ¿ï¼Ÿ" | intent: qa |
| write | "è¯·å¸®æˆ‘å†™ä¸€ä»½å…³äºAIå‘å±•çš„æŠ¥å‘Š" | intent: write |
| search | "æœç´¢æœ€æ–°çš„æœºå™¨å­¦ä¹ è®ºæ–‡" | intent: search |
| exec | "æ‰§è¡Œæ•°æ®å¤‡ä»½ä»»åŠ¡" | intent: exec |
| smalltalk | "ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ" | intent: smalltalk |

### å¤šè½®å¯¹è¯æµ‹è¯•

```
ç”¨æˆ·: "ä¸Šå‘¨çš„è´¦å•æƒ…å†µå¦‚ä½•ï¼Ÿ"
ç³»ç»Ÿ: [åˆ†æ] intent: qa, entities: {subject: "è´¦å•"}, time_text: "ä¸Šå‘¨"

ç”¨æˆ·: "ä¸Šä¸ªæœˆçš„å‘¢ï¼Ÿ"
ç³»ç»Ÿ: [åˆ†æ] intent: qa, ç»§æ‰¿ subject: "è´¦å•", æ›´æ–° time_text: "ä¸Šä¸ªæœˆ"
```

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### 1. LangSmith ç›‘æ§

LangSmith æä¾›äº†å¼ºå¤§çš„ç›‘æ§èƒ½åŠ›ï¼š

- **è°ƒç”¨é“¾è¿½è¸ª**: æŸ¥çœ‹æ¯ä¸ª LLM è°ƒç”¨çš„è¯¦ç»†ä¿¡æ¯
- **æ€§èƒ½åˆ†æ**: å“åº”æ—¶é—´ã€Token ä½¿ç”¨é‡ç»Ÿè®¡
- **é”™è¯¯è¿½è¸ª**: è¯¦ç»†çš„é”™è¯¯å †æ ˆå’Œä¸Šä¸‹æ–‡
- **A/B æµ‹è¯•**: æ¯”è¾ƒä¸åŒç‰ˆæœ¬çš„æ€§èƒ½

### 2. æ—¥å¿—åˆ†æ

ç³»ç»Ÿä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—è®°å½•å…³é”®ä¿¡æ¯ï¼š

```python
# æ„å›¾æ£€æµ‹æ—¥å¿—
logger.info("intent_detected", intent=detected_intent, confidence=confidence)

# å®ä½“æå–æ—¥å¿—
logger.info("entities_extracted", entities=entities, time_text=time_text)

# ä¸Šä¸‹æ–‡è§£ææ—¥å¿—
logger.info("context_resolved", context_frame=new_frame)
```

### 3. æ€§èƒ½æŒ‡æ ‡

å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼š

- **å“åº”æ—¶é—´**: < 2ç§’ï¼ˆç›®æ ‡ï¼‰
- **å‡†ç¡®ç‡**: > 90%ï¼ˆç›®æ ‡ï¼‰
- **å¹¶å‘å¤„ç†**: æ”¯æŒ 10+ å¹¶å‘è¯·æ±‚
- **é”™è¯¯ç‡**: < 5%

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. **ç¯å¢ƒé…ç½®**:
   ```bash
   cp .env.example .env
   # ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®å¿…è¦çš„ API Key
   ```

2. **å®‰è£…ä¾èµ–**:
   ```bash
   uv sync
   ```

3. **è¿è¡ŒåŸºç¡€æµ‹è¯•**:
   ```bash
   python scripts/test_intent_agent.py --test-type basic
   ```

4. **å¯ç”¨ LangSmith ç›‘æ§**:
   ```bash
   # è®¾ç½® LANGCHAIN_API_KEY
   python scripts/test_intent_agent.py --test-type langsmith
   ```

5. **äº¤äº’å¼æµ‹è¯•**:
   ```bash
   python scripts/test_intent_agent.py --test-type interactive
   ```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **API Key é”™è¯¯**:
   - æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ API Key é…ç½®
   - ç¡®è®¤ API Key æœ‰æ•ˆä¸”æœ‰è¶³å¤Ÿçš„é…é¢

2. **ç½‘ç»œè¿æ¥é—®é¢˜**:
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - éªŒè¯ API ç«¯ç‚¹æ˜¯å¦å¯è®¿é—®

3. **ä¾èµ–ç¼ºå¤±**:
   ```bash
   uv sync  # é‡æ–°åŒæ­¥ä¾èµ–
   ```

4. **LangSmith è¿æ¥å¤±è´¥**:
   - éªŒè¯ LANGCHAIN_API_KEY è®¾ç½®
   - æ£€æŸ¥ç½‘ç»œæ˜¯å¦èƒ½è®¿é—® smith.langchain.com

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**:
   ```bash
   export LOG_LEVEL=DEBUG
   ```

2. **ä½¿ç”¨äº¤äº’å¼æµ‹è¯•**:
   - å®æ—¶æŸ¥çœ‹å¤„ç†ç»“æœ
   - é€æ­¥éªŒè¯æ¯ä¸ªç»„ä»¶

3. **æŸ¥çœ‹ LangSmith è¿½è¸ª**:
   - è¯¦ç»†çš„è°ƒç”¨é“¾ä¿¡æ¯
   - LLM è¾“å…¥è¾“å‡ºè®°å½•

## ğŸ“ˆ æŒç»­æ”¹è¿›

1. **å®šæœŸè¿è¡Œæµ‹è¯•**: å»ºè®®æ¯æ¬¡ä»£ç å˜æ›´åè¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
2. **ç›‘æ§æ€§èƒ½æŒ‡æ ‡**: å…³æ³¨å“åº”æ—¶é—´å’Œå‡†ç¡®ç‡è¶‹åŠ¿
3. **æ”¶é›†ç”¨æˆ·åé¦ˆ**: åŸºäºå®é™…ä½¿ç”¨æƒ…å†µä¼˜åŒ–æ„å›¾åˆ†ç±»
4. **æ›´æ–°æµ‹è¯•ç”¨ä¾‹**: æ ¹æ®æ–°çš„ä¸šåŠ¡åœºæ™¯æ·»åŠ æµ‹è¯•ç”¨ä¾‹

## ğŸ¤ è´¡çŒ®æŒ‡å—

å¦‚æœæ‚¨æƒ³æ”¹è¿›æµ‹è¯•å¥—ä»¶ï¼š

1. æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹åˆ°ç›¸åº”çš„æµ‹è¯•æ–‡ä»¶
2. æ›´æ–°æ–‡æ¡£è¯´æ˜æ–°çš„æµ‹è¯•åŠŸèƒ½
3. ç¡®ä¿æ‰€æœ‰æµ‹è¯•éƒ½èƒ½é€šè¿‡
4. æäº¤ Pull Request

---

æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Ÿè¯·åˆ›å»º Issue æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚
